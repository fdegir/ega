on:
  push:
    tags-ignore:
      - '*.*'
  pull_request:
    types: [opened, reopened, closed]

jobs:
  # Generate and publish EiffelSourceChangeCreatedEvent for PRs opened or reopened
  send_escc:
    if: github.event_name == 'pull_request' && (github.event.action == 'opened' || github.event.action == 'reopened')
    runs-on: ubuntu-20.04
    name: Generate and publish EiffelSourceChangeCreatedEvent
    steps:
      - name: Generate and publish EiffelSourceChangeCreatedEvent
        id: publish-event
        uses: fdegir/ega@v13
        with:
          mp: 'eiffelsemantics'
          eiffel_event_type: 'EiffelSourceChangeCreatedEvent'
      - name: Display generated EiffelSourceChangeCreatedEvent
        run: echo "Generated EiffelSourceChangeCreatedEvent: ${{ steps.send_escc.outputs.event_body }}"
  # Generate and publish EiffelSourceChangeSubmittedEvent for pushes and merged PRs
  send_escs:
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.pull_request.merged == true)
    runs-on: ubuntu-20.04
    name: Generate and publish EiffelSourceChangeSubmittedEvent
    steps:
      - name: Query Eiffel Events step
        id: publish-event
        uses: fdegir/ega@v13
        with:
          mp: 'eiffelsemantics'
          eiffel_event_type: 'EiffelSourceChangeSubmittedEvent'
      - name: Display generated EiffelSourceChangeSubmittedEvent
        run: echo "Generated EiffelSourceChangeSubmittedEvent: ${{ steps.send_escs.outputs.event_body }}"
